<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
let packages = [];
const apiURL = "http://localhost:5000/packages";
const bookingAPI = "http://localhost:5000/bookings";

async function loadPackages() {
  const res = await fetch(apiURL);
  packages = await res.json();
  renderPackages(packages);
}

function renderPackages(data) {
  ["domestic", "international", "spiritual"].forEach(c => {
    document.getElementById(c + "Container").innerHTML = "";
  });

  // Group packages by category
  const categories = {
    domestic: data.filter(p => p.category?.toLowerCase() === "domestic"),
    international: data.filter(p => p.category?.toLowerCase() === "international"),
    spiritual: data.filter(p => p.category?.toLowerCase() === "spiritual")
  };

  Object.keys(categories).forEach(cat => {
    const container = document.getElementById(cat + "Container");
    const carouselId = `${cat}Carousel`;

    // Create carousel wrapper
    container.innerHTML = `
      <div id="${carouselId}" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
        <div class="carousel-inner"></div>
        <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>
      </div>
    `;

    const carouselInner = container.querySelector(".carousel-inner");
    const pkgs = categories[cat].slice(0, 8);

    // Create carousel slides â€” 4 cards per slide
    for (let i = 0; i < pkgs.length; i += 4) {
      const rowPkgs = pkgs.slice(i, i + 4);
      const item = document.createElement("div");
      item.className = `carousel-item ${i === 0 ? "active" : ""}`;
      const row = document.createElement("div");
      row.className = "row justify-content-center";

      rowPkgs.forEach(pkg => {
        const col = document.createElement("div");
        col.className = "col-md-3 col-sm-6 mb-4";
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <a href="packagedetails.html?id=${pkg.id}">
              <img src="${pkg.image}" class="card-img-top" alt="${pkg.name}">
            </a>
            <div class="card-body">
              <h5 class="card-title">${pkg.name}</h5>
              <div class="duration-price d-flex justify-content-between">
                <span>${pkg.duration}</span>
                <span>Price on Request</span>
              </div>
              <div class="d-flex justify-content-around package-icons my-3">
                <div><i class="fa-solid fa-hotel text-primary"></i><p>Hotel</p></div>
                <div><i class="fa-solid fa-car text-success"></i><p>Cabs</p></div>
                <div><i class="fa-solid fa-utensils text-danger"></i><p>Meals</p></div>
                <div><i class="fa-solid fa-mountain-sun text-warning"></i><p>Sightseeing</p></div>
              </div>
              <button class="btn btn-primary w-100 mt-2" onclick="bookNow('${pkg.id}')">Book Now</button>
            </div>
          </div>
        `;
        row.appendChild(col);
      });

      item.appendChild(row);
      carouselInner.appendChild(item);
    }

    // Add "Load More" button below carousel
    const loadMoreBtn = document.createElement("div");
    loadMoreBtn.className = "text-center my-3";
    loadMoreBtn.innerHTML = `<a href="${cat}.html" class="btn btn-primary btn-lg">Load More....</a>`;
    container.appendChild(loadMoreBtn);
  });
}

function showDetails(id) {
  const pkg = packages.find(p => p.id == id);
  document.getElementById("modalTitle").innerText = pkg.name;
  document.getElementById("modalImage").src = pkg.image;
  document.getElementById("modalDuration").innerText = pkg.duration;
  document.getElementById("modalOverview").innerText = pkg.overview || "";
  document.getElementById("modalItinerary").innerText = pkg.itinerary || "";
  document.getElementById("modalTerms").innerText = pkg.terms || "";

  const incl = Array.isArray(pkg.inclusions) ? pkg.inclusions : (pkg.inclusions ? pkg.inclusions.split(",") : []);
  const excl = Array.isArray(pkg.exclusions) ? pkg.exclusions : (pkg.exclusions ? pkg.exclusions.split(",") : []);
  document.getElementById("modalInclusions").innerHTML = incl.map(i=>`<li>${i.trim()}</li>`).join("");
  document.getElementById("modalExclusions").innerHTML = excl.map(i=>`<li>${i.trim()}</li>`).join("");

  document.getElementById("modalPDF").href = pkg.pdf ? pkg.pdf : "#";
  document.getElementById("modalPDF").style.display = pkg.pdf ? "inline-block" : "none";

  document.getElementById("modalBook").onclick = () => {
    bootstrap.Modal.getInstance(document.getElementById("detailsModal")).hide();
    setTimeout(()=>bookNow(id),500);
  };
}

// Dummy booking handler
function bookNow(id) {
  alert("Booking started for package ID: " + id);
}

// Load all packages
loadPackages();
</script>
